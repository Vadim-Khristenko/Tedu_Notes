# –ö–æ–Ω—Å–ø–µ–∫—Ç –æ—Ç 27.09.2025 | –õ–µ–∫—Ü–∏—è —É—Ä–æ–≤–Ω—è –•–∞—Ä–¥ (–ü–∞—Ä–∞–ª–ª–µ–ª—å: B-X)
## –¢–µ–º–∞: –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è —Ç–µ–æ—Ä–∏—è —á–∏—Å–µ–ª.

> –ê–≤—Ç–æ—Ä: –í–∞–¥–∏–º –•—Ä–∏—Å—Ç–µ–Ω–∫–∫–æ  
> –ß–µ—Å—Ç–Ω–æ –≤ –∫–æ–Ω—Å–ø–µ–∫—Ç–µ –ø–æ—á—Ç–∏ –≤—Å—ë –ø–µ—Ä–µ—Å–∫–∞–∑–∞–Ω–æ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.
> –ù—É –∏ –µ—â—ë –¥–æ–∫-–≤–æ –µ—Å—Ç—å –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–µ–æ—Ä–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –ª–µ–∫—Ü–∏–∏ –ø—Ä–æ—à–ª–∏ –º–µ—Ç–æ–¥–æ–º —Å–∫–∏–ø–∞.

---



## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –∏ –±–∞–∑–æ–≤—ã–µ —à—Ç—É–∫–∏](#–æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è-–∏-–±–∞–∑–æ–≤—ã–µ-—à—Ç—É–∫–∏)
- [–ü–æ–ª–µ $\mathbb{Z}_p$: —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º](#–ø–æ–ª–µ-mathbbz_p-—á—Ç–æ-—ç—Ç–æ-–∏-–∑–∞—á–µ–º)
- [–ú–Ω–æ–≥–æ—á–ª–µ–Ω—ã –≤ $\mathbb{Z}_p$: –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –ø–∞–Ω–∏–∫–∏](#–º–Ω–æ–≥–æ—á–ª–µ–Ω—ã-–≤-mathbbz_p-–±—ã—Å—Ç—Ä–æ-–∏-–±–µ–∑-–ø–∞–Ω–∏–∫–∏)
- [–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ (–ø–µ—Ä–≤–æ–æ–±—Ä–∞–∑–Ω—ã–µ) –∫–æ—Ä–Ω–∏ ‚Äî –∫—Ç–æ –æ–Ω–∏ –∏ –∑–∞—á–µ–º –Ω—É–∂–Ω—ã](#–ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ-–ø–µ—Ä–≤–æ–æ–±—Ä–∞–∑–Ω—ã–µ-–∫–æ—Ä–Ω–∏--–∫—Ç–æ-–æ–Ω–∏-–∏-–∑–∞—á–µ–º-–Ω—É–∂–Ω—ã)
- [–ö–∞–∫ –∏—Å–∫–∞—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å?](#–∫–∞–∫-–∏—Å–∫–∞—Ç—å-–ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π-–∫–æ—Ä–µ–Ω—å)
- [–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ $\mathbb{Z}_p$](#–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ-—É—Ä–∞–≤–Ω–µ–Ω–∏—è-–≤-mathbbz_p)
- [–°–∏–º–≤–æ–ª –õ–µ–∂–∞–Ω–¥—Ä–∞ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–π –≠–π–ª–µ—Ä–∞](#—Å–∏–º–≤–æ–ª-–ª–µ–∂–∞–Ω–¥—Ä–∞-–∏-–∫—Ä–∏—Ç–µ—Ä–∏–π-—ç–π–ª–µ—Ä–∞)
- [–ê–ª–≥–æ—Ä–∏—Ç–º –¢–æ–Ω–µ–ª–ª–∏‚Äì–®–µ–Ω–∫—Å–∞ ‚Äî –∫–∞–∫ –∏–∑–≤–ª–µ—á—å –∫–æ—Ä–µ–Ω—å –ø–æ –º–æ–¥—É–ª—é](#–∞–ª–≥–æ—Ä–∏—Ç–º-—Ç–æ–Ω–µ–ª–ª–∏‚Äì—à–µ–Ω–∫—Å–∞--–∫–∞–∫-–∏–∑–≤–ª–µ—á—å-–∫–æ—Ä–µ–Ω—å-–ø–æ-–º–æ–¥—É–ª—é)
- [–®–ø–∞—Ä–≥–∞–ª–∫–∞: —á—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å](#—à–ø–∞—Ä–≥–∞–ª–∫–∞-—á—Ç–æ-–∑–∞–ø–æ–º–Ω–∏—Ç—å)
- [–ü–æ–ª–µ–∑–Ω—ã–µ –ª–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏](#–ø–æ–ª–µ–∑–Ω—ã–µ-–ª–∞–π—Ñ—Ö–∞–∫–∏-–∏-—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏)

---

## –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –∏ –±–∞–∑–æ–≤—ã–µ —à—Ç—É–∫–∏

| –û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ | –ß—Ç–æ –∑–Ω–∞—á–∏—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|------------|-------------|
| $p$ | –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ (–æ–±—ã—á–Ω–æ $10^9+7$, $998244353$) | –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ–µ –≤ –∑–∞–¥–∞—á–∞—Ö |
| $\mathbb{Z}_p$ | –º–Ω–æ–∂–µ—Å—Ç–≤–æ $\{0, 1, ..., p-1\}$ —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –ø–æ –º–æ–¥—É–ª—é $p$ | —ç—Ç–æ –ø–æ–ª–µ! |
| $a^{-1} \bmod p$ | –æ–±—Ä–∞—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∫ $a$ | $a \cdot a^{-1} \equiv 1 \pmod p$ |
| $a^{p-2} \bmod p$ | —Å–ø–æ—Å–æ–± –Ω–∞–π—Ç–∏ $a^{-1}$ | —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –º–∞–ª–æ–π —Ç–µ–æ—Ä–µ–º–µ –§–µ—Ä–º–∞ |
| `mod_pow(a, e, p)` | –±—ã—Å—Ç—Ä–æ–µ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å | O(log e) |
| `__int128` | —Ç–∏–ø –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è | —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å `long long` |

---

## –ü–æ–ª–µ $\mathbb{Z}_p$: —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –Ω–µ —Å –æ–±—ã—á–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏, –∞ —Å —á–∏—Å–ª–∞–º–∏ **–ø–æ –º–æ–¥—É–ª—é –ø—Ä–æ—Å—Ç–æ–≥–æ —á–∏—Å–ª–∞ $p$**. –≠—Ç–æ –∫–∞–∫ –∑–∞–º–∫–Ω—É—Ç–∞—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è: –≤—Å—ë, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å (—Å–ª–æ–∂–µ–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ, –¥–µ–ª–µ–Ω–∏–µ), –æ—Å—Ç–∞—ë—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ $\{0, 1, ..., p-1\}$.

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä—É—Ç–æ?**
- –î–µ–ª–µ–Ω–∏–µ = —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç.
- –ù–µ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å (–∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ –Ω—É–ª—è, –∫–æ–Ω–µ—á–Ω–æ).
- –ì—Ä—É–ø–ø–∞ $\mathbb{Z}_p^* = \{1, 2, ..., p-1\}$ ‚Äî **—Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è** ‚Üí –µ—Å—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å!

**–ö–∞–∫ –¥–µ–ª–∏—Ç—å?**  
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å $\frac{a}{b} \bmod p$, –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π:
```cpp
(a * mod_inv(b, p)) % p
```
–ê `mod_inv(b, p)` = `mod_pow(b, p-2, p)`.

---

## –ú–Ω–æ–≥–æ—á–ª–µ–Ω—ã –≤ $\mathbb{Z}_p$: –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –ø–∞–Ω–∏–∫–∏

–ú–Ω–æ–≥–æ—á–ª–µ–Ω ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:  
`P(x) = a0 + a1*x + a2*x^2 + ...`

### –ö–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ?
–ò—Å–ø–æ–ª—å–∑—É–π **—Å—Ö–µ–º—É –ì–æ—Ä–Ω–µ—Ä–∞** ‚Äî –æ–Ω–∞ –∏ –±—ã—Å—Ç—Ä–∞—è, –∏ –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç:

```cpp
int64 eval(const vector<int64>& a, int64 x, int64 p) {
    int64 res = 0;
    for (int i = (int)a.size() - 1; i >= 0; --i)
        res = ((i128)res * x + a[i]) % p;
    return (res + p) % p;
}
```

> üí° –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ `[a0, a1, a2, ...]`.

### –£–º–Ω–æ–∂–µ–Ω–∏–µ –º–Ω–æ–≥–æ—á–ª–µ–Ω–æ–≤
–ï—Å–ª–∏ —Å—Ç–µ–ø–µ–Ω–∏ ‚â§ 1000 ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∞:

```cpp
vector<int64> mul(const vector<int64>& A, const vector<int64>& B, int64 p) {
    vector<int64> C(A.size() + B.size() - 1);
    for (int i = 0; i < A.size(); ++i)
        for (int j = 0; j < B.size(); ++j)
            C[i+j] = (C[i+j] + (i128)A[i] * B[j]) % p;
    return C;
}
```

> üî• –ï—Å–ª–∏ —Å—Ç–µ–ø–µ–Ω–∏ –±–æ–ª—å—à–∏–µ ‚Äî –¥—É–º–∞–π –ø—Ä–æ NTT (–Ω–æ —ç—Ç–æ —É–∂–µ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–µ–º–∞).

---

## –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ (–ø–µ—Ä–≤–æ–æ–±—Ä–∞–∑–Ω—ã–µ) –∫–æ—Ä–Ω–∏ ‚Äî –∫—Ç–æ –æ–Ω–∏ –∏ –∑–∞—á–µ–º –Ω—É–∂–Ω—ã

**–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å –ø–æ –º–æ–¥—É–ª—é $p$** ‚Äî —ç—Ç–æ —Ç–∞–∫–æ–µ —á–∏—Å–ª–æ $g$, —á—Ç–æ –µ–≥–æ —Å—Ç–µ–ø–µ–Ω–∏ –¥–∞—é—Ç **–≤—Å–µ –Ω–µ–Ω—É–ª–µ–≤—ã–µ –≤—ã—á–µ—Ç—ã**:

$$
g^1, g^2, ..., g^{p-1} \equiv 1, 2, ..., p-1 \pmod p \quad (\text{–≤ –∫–∞–∫–æ–º-—Ç–æ –ø–æ—Ä—è–¥–∫–µ})
$$

–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: **–ø–æ—Ä—è–¥–æ–∫** $g$ —Ä–∞–≤–µ–Ω $p-1$.

### –ó–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?
- –î–ª—è **–¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ–≥–∞—Ä–∏—Ñ–º–∞** (baby-step giant-step).
- –î–ª—è **NTT** (Number Theoretic Transform) ‚Äî –∞–Ω–∞–ª–æ–≥ FFT –≤ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–µ.
- –ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã –ø–µ—Ä–µ–±—Ä–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã $\mathbb{Z}_p^*$ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π.

### –°–≤–æ–π—Å—Ç–≤–∞
- –°—É—â–µ—Å—Ç–≤—É–µ—Ç **–¥–ª—è –ª—é–±–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ $p$**.
- –ò—Ö —Ä–æ–≤–Ω–æ $\varphi(p-1)$ —à—Ç—É–∫.
- –ü–µ—Ä–≤—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –∫–æ—Ä–Ω–∏ –æ–±—ã—á–Ω–æ **–æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ** (—á–∞—Å—Ç–æ 2, 3, 5...).

---

## –ö–∞–∫ –∏—Å–∫–∞—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å?

–ò–¥–µ—è:  
–ü—É—Å—Ç—å $p-1 = q_1^{e_1} q_2^{e_2} \dots q_k^{e_k}$ ‚Äî —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ.  
–¢–æ–≥–¥–∞ $g$ ‚Äî –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å **—Ç–æ–≥–¥–∞ –∏ —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞**, –∫–æ–≥–¥–∞:

$$
g^{(p-1)/q_i} \not\equiv 1 \pmod p \quad \text{–¥–ª—è –≤—Å–µ—Ö } i
$$

–ü–æ—á–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ –µ—Å–ª–∏ $g^{(p-1)/q} \equiv 1$, —Ç–æ –ø–æ—Ä—è–¥–æ–∫ $g$ –¥–µ–ª–∏—Ç $(p-1)/q$ ‚Üí –æ–Ω **–º–µ–Ω—å—à–µ** $p-1$ ‚Üí –Ω–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
vector<int64> prime_factors(int64 n) {
    vector<int64> f;
    for (int64 p = 2; p * p <= n; ++p) {
        if (n % p == 0) {
            f.push_back(p);
            while (n % p == 0) n /= p;
        }
    }
    if (n > 1) f.push_back(n);
    return f;
}

int64 find_primitive_root(int64 p) {
    if (p == 2) return 1;
    auto primes = prime_factors(p - 1);
    for (int64 g = 2; g < p; ++g) {
        bool ok = true;
        for (int64 q : primes)
            if (mod_pow(g, (p - 1) / q, p) == 1) { ok = false; break; }
        if (ok) return g;
    }
    return -1; // –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∏—Ç—å—Å—è
}
```

> üí° –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –ø–µ—Ä–µ–±–æ—Ä –¥–æ 10 –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∫–æ—Ä–µ–Ω—å.

---

## –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ $\mathbb{Z}_p$

–†–µ—à–∞–µ–º:  
$$
ax^2 + bx + c \equiv 0 \pmod p
$$

### –®–∞–≥ 1: –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤–∏–¥—É $x^2 + Bx + C = 0$
–ï—Å–ª–∏ $a \ne 0$, –¥–æ–º–Ω–æ–∂–∞–µ–º –Ω–∞ $a^{-1}$:
```cpp
int64 inv_a = mod_inv(a, p);
int64 B = (i128)b * inv_a % p;
int64 C = (i128)c * inv_a % p;
```

### –®–∞–≥ 2: –°—á–∏—Ç–∞–µ–º –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç
$$
D = B^2 - 4C \pmod p
$$

–¢–µ–ø–µ—Ä—å –≤—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, **–µ—Å—Ç—å –ª–∏ —É $D$ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å –ø–æ –º–æ–¥—É–ª—é $p$**.

---

## –°–∏–º–≤–æ–ª –õ–µ–∂–∞–Ω–¥—Ä–∞ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–π –≠–π–ª–µ—Ä–∞

**–°–∏–º–≤–æ–ª –õ–µ–∂–∞–Ω–¥—Ä–∞** –≥–æ–≤–æ—Ä–∏—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —á–∏—Å–ª–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—ã–º –≤—ã—á–µ—Ç–æ–º:

$$
\left( \frac{a}{p} \right) =
\begin{cases}
0, & a \equiv 0 \pmod p \\
1, & \exists x: x^2 \equiv a \pmod p \\
-1, & \text{–∏–Ω–∞—á–µ}
\end{cases}
$$

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≠–π–ª–µ—Ä–∞** (–∫–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å):
$$
\left( \frac{a}{p} \right) \equiv a^{(p-1)/2} \pmod p
$$

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
int legendre(int64 a, int64 p) {
    a %= p;
    if (a == 0) return 0;
    int64 r = mod_pow(a, (p - 1) / 2, p);
    return (r == 1) ? 1 : -1;
}
```

> üí° –ï—Å–ª–∏ `legendre(D, p) == -1` ‚Üí —Ä–µ—à–µ–Ω–∏–π –Ω–µ—Ç.

---

## –ê–ª–≥–æ—Ä–∏—Ç–º –¢–æ–Ω–µ–ª–ª–∏‚Äì–®–µ–Ω–∫—Å–∞ ‚Äî –∫–∞–∫ –∏–∑–≤–ª–µ—á—å –∫–æ—Ä–µ–Ω—å –ø–æ –º–æ–¥—É–ª—é

–ï—Å–ª–∏ $\left( \frac{a}{p} \right) = 1$, —Ç–æ –∫–æ—Ä–µ–Ω—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ù–æ –∫–∞–∫ –µ–≥–æ –Ω–∞–π—Ç–∏?

–ü–µ—Ä–µ–±–æ—Ä (`for x in 1..p`) —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö $p$. –î–ª—è –±–æ–ª—å—à–∏—Ö ‚Äî **–¢–æ–Ω–µ–ª–ª–∏‚Äì–®–µ–Ω–∫—Å**.

### –ö–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ)?
- –†–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ–º $p-1 = q \cdot 2^s$.
- –ù–∞—Ö–æ–¥–∏–º ¬´–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç¬ª $z$ (—Å–∏–º–≤–æ–ª –õ–µ–∂–∞–Ω–¥—Ä–∞ = -1).
- –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —É–ª—É—á—à–∞–µ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –∫ –∫–æ—Ä–Ω—é, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–µ–ø–µ–Ω–∏ $z$.

### –ö–æ–¥ (—Ä–∞–±–æ—á–∏–π, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π)

```cpp
int64 tonelli_shanks(int64 a, int64 p) {
    if (a == 0) return 0;
    if (p == 2) return a;
    if (legendre(a, p) != 1) return -1;

    int64 q = p - 1, s = 0;
    while ((q & 1) == 0) { q >>= 1; ++s; }

    if (s == 1) return mod_pow(a, (p + 1) / 4, p);

    int64 z = 2;
    while (legendre(z, p) != -1) ++z;

    int64 c = mod_pow(z, q, p);
    int64 r = mod_pow(a, (q + 1) / 2, p);
    int64 t = mod_pow(a, q, p);
    int64 m = s;

    while (t != 1) {
        int64 i = 0, tt = t;
        while (tt != 1) {
            tt = (i128)tt * tt % p;
            ++i;
            if (i == m) return -1;
        }
        int64 b = mod_pow(c, 1LL << (m - i - 1), p);
        r = (i128)r * b % p;
        c = (i128)b * b % p;
        t = (i128)t * c % p;
        m = i;
    }
    return r;
}
```

> üí° –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ –∫–æ—Ä–Ω–µ–π. –í—Ç–æ—Ä–æ–π ‚Äî —ç—Ç–æ `p - r`.

---

## –®–ø–∞—Ä–≥–∞–ª–∫–∞: —á—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å

| –¢–µ–º–∞ | –§–æ—Ä–º—É–ª–∞ / –£—Å–ª–æ–≤–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|------|-------------------|----------|
| –û–±—Ä–∞—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç | $a^{-1} \equiv a^{p-2} \pmod p$ | $O(\log p)$ |
| –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å | $g^{(p-1)/q} \not\equiv 1$ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Å—Ç—ã—Ö $q \mid p-1$ | $O(\sqrt{p} + k \log p)$ |
| –°–∏–º–≤–æ–ª –õ–µ–∂–∞–Ω–¥—Ä–∞ | $a^{(p-1)/2} \bmod p$ | $O(\log p)$ |
| –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å | Tonelli‚ÄìShanks | $O(\log^2 p)$ |
| –†–µ—à–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è | $x = \frac{-B \pm \sqrt{D}}{2}$ | –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ—Ä–Ω—è |

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –ª–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

‚úÖ **–í—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É–π –æ—Å—Ç–∞—Ç–∫–∏**:  
```cpp
x = (x % p + p) % p;
```

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π `__int128` –ø—Ä–∏ —É–º–Ω–æ–∂–µ–Ω–∏–∏**:  
```cpp
(i128)a * b % p
```

‚ùå **–ù–µ –¥–µ–ª–∏ –Ω–∞ 2 –∫–∞–∫ `x / 2`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `mod_inv(2, p)`.

‚ùå **–ù–µ –∑–∞–±—ã–≤–∞–π, —á—Ç–æ $p$ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ—á—ë—Ç–Ω—ã–º** –≤ Tonelli‚ÄìShanks.

‚úÖ **–ï—Å–ª–∏ $p = 2$** ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω–æ (—Ç–∞–º –≤—Å—ë —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ).

‚úÖ **–§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è $p-1$** ‚Äî –ø–µ—Ä–µ–±–æ—Ä –¥–æ $\sqrt{p}$ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è $p \leq 10^9$.

‚úÖ **–ü–µ—Ä–≤—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ ‚â§ 10** ‚Äî –Ω–µ –±–æ–π—Å—è –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–æ—Ä–∏—è —á–∏—Å–µ–ª –≤ –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö ‚Äî —ç—Ç–æ –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ. –≠—Ç–æ **–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏, –≥–¥–µ ¬´–æ–±—ã—á–Ω—ã–µ¬ª –º–µ—Ç–æ–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –ø–æ–Ω–∏–º–∞—Ç—å **–ø–æ—á–µ–º—É** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥–∞—è —Ñ–æ—Ä–º—É–ª–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏–ø–∞—Å—Ç–∏—Ç—å.

–ó–∞–ø–æ–º–Ω–∏:
- $\mathbb{Z}_p$ ‚Äî —Ç–≤–æ—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è.
- –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–µ–Ω—å ‚Äî —Ç–≤–æ–π –¥—Ä—É–≥.
- –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫–æ—Ä–Ω–∏ ‚Äî –Ω–µ –º–∞–≥–∏—è, –∞ Tonelli‚ÄìShanks.
- –ò **–≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –≥—Ä–∞–Ω–∏—Ü—ã** (–æ—Å–æ–±–µ–Ω–Ω–æ $p = 2$!).

–£–¥–∞—á–∏ –Ω–∞ –∫–æ–Ω—Ç–µ—Å—Ç–∞—Ö! üçµ  
*P.S. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—å –∑–Ω–∞–∫–∏ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ –º–æ–¥—É–ª—é. 90% –±–∞–≥–æ–≤ ‚Äî —Ç–∞–º.*

---

$\text{–û—Ç —É—á–µ–Ω–∏–∫–∞ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤.}\\ \text{\textcolor{red}{–° –ª—é–±–æ–≤—å—é} –∫ \textcolor{yellow}{–¢-–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é}.}\\ \textcolor{#86cecb}{–í–∞–¥–∏–º\ –•—Ä–∏—Å—Ç–µ–Ω–∫–æ.}$